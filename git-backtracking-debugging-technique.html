<!DOCTYPE html><html lang="en-us" data-theme="green-gray"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Git Backtracking Debugging Technique - Captain Embedded üë®üèª‚Äç‚úàÔ∏è‚öì</title><meta name="description" content="There are 2 great pieces of advice when you're doing firmware development: Commits are free so you should use them whenever possible. It will make your life easy when it comes to tracking code changes. Because in the entire firmware development, you will make hundreds if not thousands changes to&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script defer="defer" type="text/javascript" data-domain="rosmianto.com" src="https://view.rosmianto.com/js/script.outbound-links.tagged-events.js"></script><script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script><link rel="stylesheet" href="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-gray.css"><link rel="stylesheet" href="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-inline-color.css"><link rel="canonical" href="https://rosmianto.com/git-backtracking-debugging-technique.html"><meta property="og:title" content="Git Backtracking Debugging Technique"><meta property="og:image" content="https://rosmianto.com/media/posts/12/git-history-white.png"><meta property="og:image:width" content="2442"><meta property="og:image:height" content="1000"><meta property="og:site_name" content="Captain Embedded üë®üèª‚Äç‚úàÔ∏è‚öì"><meta property="og:description" content="There are 2 great pieces of advice when you're doing firmware development: Commits are free so you should use them whenever possible. It will make your life easy when it comes to tracking code changes. Because in the entire firmware development, you will make hundreds if not thousands changes to&hellip;"><meta property="og:url" content="https://rosmianto.com/git-backtracking-debugging-technique.html"><meta property="og:type" content="article"><link rel="alternate" type="application/atom+xml" href="https://rosmianto.com/feed.xml"><link rel="alternate" type="application/json" href="https://rosmianto.com/feed.json"><link rel="preload" href="https://rosmianto.com/assets/dynamic/fonts/lora/lora.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://rosmianto.com/assets/dynamic/fonts/lora/lora-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://rosmianto.com/assets/css/style.css?v=306817db79d51e04a1e9a5621658ebe7"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://rosmianto.com/git-backtracking-debugging-technique.html"},"headline":"Git Backtracking Debugging Technique","datePublished":"2024-03-18T10:08+07:00","dateModified":"2024-03-22T16:36+07:00","image":{"@type":"ImageObject","url":"https://rosmianto.com/media/posts/12/git-history-white.png","height":1000,"width":2442},"description":"There are 2 great pieces of advice when you're doing firmware development: Commits are free so you should use them whenever possible. It will make your life easy when it comes to tracking code changes. Because in the entire firmware development, you will make hundreds if not thousands changes to&hellip;","author":{"@type":"Person","name":"Rosmianto A. Saputro","url":"https://rosmianto.com/authors/rosmianto-a-saputro/"},"publisher":{"@type":"Organization","name":"Rosmianto A. Saputro"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><header class="header" id="js-header"><div><a class="logo" href="https://rosmianto.com/">Captain Embedded üë®üèª‚Äç‚úàÔ∏è‚öì</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://rosmianto.com/authors/rosmianto-a-saputro/" target="_self">Articles</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Products (NEW üî•)</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://freelancer.rosmianto.com/" target="_self">Becoming Embedded Freelancer</a></li><li><a href="https://fwguide.rosmianto.com" target="_blank">Firmware Development Guide</a></li></ul></li><li><a href="https://newsletter.rosmianto.com" target="_blank">Newsletter</a></li><li><a href="https://www.linkedin.com/in/rosmianto/" target="_blank">LinkedIn</a></li></ul></nav></div></header><main class="post"><article class="content"><header class="content__inner content__header--centered"><h1 class="h0 content__title">Git Backtracking Debugging Technique</h1><div class="content__meta"><div class="content__meta__author"><img src="https://rosmianto.com/media/website/Untitled-Diagram.jpg" loading="eager" height="1700" width="1700" class="content__avatar" alt="Rosmianto A. Saputro"><div><a href="https://rosmianto.com/authors/rosmianto-a-saputro/" class="content__author">Rosmianto A. Saputro</a> <time datetime="2024-03-18T10:08" class="content__date">March 18, 2024</time></div></div></div></header><div class="content__body"><div class="content__inner"><div class="content__entry"><p>There are 2 great pieces of advice when you're doing firmware development:</p><ol><li>Use Git and GitHub</li><li>Make commits as small as practically possible</li></ol><p>Commits are free so you should use them whenever possible. It will make your life easy when it comes to tracking code changes.</p><h1>Why Should I Track My Code?</h1><p>Because in the entire firmware development, you will make hundreds if not thousands changes to the code. You will be introducing new features, testing out a new architecture, refactoring some code smells here and there, paying technical debts, and hundreds of other things you might do to the code.</p><p>But because we're human, we can make errors.</p><p>From minor typos, to revenue-affecting critical bugs. At some points in our embedded career, we will make mistakes, even senior engineers still can make mistakes. And we often backup our work to prevent something wrong happen. We want to make sure we can restore chaos when something terrible happens. In other words, we backup as an assurance.</p><p>Code tracking is a form of backup.</p><p>It offers an unlimited and easy way to backup every step we make. And this article will explain to you how to effectively use git to help your debugging activity.</p><p class="msg msg--info">On April 6th 2021, a university researcher submitted a patch to Linux kernel maintainers. The maintainers accepted the patch and merged it to the kernel code.<br><br><a href="https://www.theverge.com/2021/4/30/22410164/linux-kernel-university-of-minnesota-banned-open-source" target="_blank" rel="noopener noreferrer">It turned out that the researcher has injected malicious code into the patch as a study for his university research</a>. Treating Linux kernel community as his lab guinea pig.<br><br>Maintainers were not happy with this and instantly ripped out his code from the kernel.<br><br>Without using code tracking (in this case, git), the maintainers will have a tedious day checking one by one the malicious code, and deleting them line by line.<br><br>Another example of using git will make your life easier in many situations.<br><br>The researcher and the entire university have been banned from submitting future patches. Very sad.</p><h1>How to Pinpoint The Bug with Git</h1><p>Let's say you have a project with commits like this:</p><figure><figure class="post__image post__image--center"><img loading="lazy" src="https://rosmianto.com/media/posts/12/git-history-2.png" alt="" width="500" height="205" sizes="(max-width: 1200px) 100vw, 1200px" srcset="https://rosmianto.com/media/posts/12/responsive/git-history-2-xs.png 300w, https://rosmianto.com/media/posts/12/responsive/git-history-2-sm.png 480w, https://rosmianto.com/media/posts/12/responsive/git-history-2-md.png 768w, https://rosmianto.com/media/posts/12/responsive/git-history-2-xl.png 1200w"></figure><figcaption>Each circle represents your commit. You have 5 days' worth of commits</figcaption></figure><p>On April 5, you make a commit and test the code. Suddenly, a wild bug appears and makes the whole system crash. You reset the device, still crashes.</p><p>You're confused because you just added a minor feature. It shouldn't crash.</p><p>In this situation, you decided to revert back to commit Apr 4:</p><p><code>git checkout commit-apr4-hash</code></p><p>You rebuild the project and pufff, the bug is gone!</p><p>At this point, you can reasonably assume that commit-apr5 is causing the problem.</p><p class="msg msg--info">If you have hundreds of commits, this process can be tedious. Use <code>git bisect</code> to help you automate the pinpointing process.</p><h1>Find the Root Cause</h1><p>Use git diff to find code changes that caused the issue:</p><p><code>git diff commit-apr5-hash commit-apr4-hash</code></p><p>You might find some silly like <a href="https://en.wikipedia.org/wiki/Off-by-one_error" target="_blank" rel="noopener noreferrer">off-by-one errors</a>, <a href="https://encyclopedia.kaspersky.com/glossary/use-after-free/" target="_blank" rel="noopener noreferrer">use-after-free errors.</a> Or maybe you will find something more serious like a race condition, deadlock, and starving tasks. Now it's your job to figure out how to solve it.</p><p>You might ask, what if the git diff result is too big, like 1000 lines too big?</p><p>Well, glad you asked. That's why in the first paragraph I said to make git commits as small as humanly possible. This will prevent your git diff become a mammoth.</p><p>What if you already made a big diff? Well, good luck finding the root cause haha üòÅ¬†</p><h1>Update: A Small Example</h1><p>You won't believe it. I wrote this article on Apr 18th, 2024. And one day after publishing the article, I faced a bug which I solved using this technique. I guess I have to walk the talk. Let's go.</p><p>I was working on my employer's firmware code. I have this commit history:</p><figure><figure class="post__image post__image--center"><img loading="lazy" src="https://rosmianto.com/media/posts/12/Screenshot-from-2024-03-19-09-32-05.png" alt="" width="700" height="106" sizes="(max-width: 1200px) 100vw, 1200px" srcset="https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-09-32-05-xs.png 300w, https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-09-32-05-sm.png 480w, https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-09-32-05-md.png 768w, https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-09-32-05-xl.png 1200w"></figure><figcaption>4 commits in a morning. Make sure to keep them small</figcaption></figure><p>The problem is, in the latest commit the firmware is crashing without a clear explanation (Add WiFi button):</p><figure><figure class="post__image post__image--center"><img loading="lazy" src="https://rosmianto.com/media/posts/12/Screenshot-from-2024-03-19-09-36-40.png" alt="" width="804" height="576" sizes="(max-width: 1200px) 100vw, 1200px" srcset="https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-09-36-40-xs.png 300w, https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-09-36-40-sm.png 480w, https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-09-36-40-md.png 768w, https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-09-36-40-xl.png 1200w"></figure><figcaption>I use ESP32 and this is the system crash log</figcaption></figure><p>I applied the backtracking debugging technique by reverting back the commits one by one. Suddenly the bug vanished in the commit hash <code>10dfaaea</code>.</p><p>Checking the diff, I only touched a small part of the files. Nothing weird:</p><figure><figure class="post__image post__image--center"><img loading="lazy" src="https://rosmianto.com/media/posts/12/Screenshot-from-2024-03-19-10-00-53.png" alt="" width="395" height="284" sizes="(max-width: 1200px) 100vw, 1200px" srcset="https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-10-00-53-xs.png 300w, https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-10-00-53-sm.png 480w, https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-10-00-53-md.png 768w, https://rosmianto.com/media/posts/12/responsive/Screenshot-from-2024-03-19-10-00-53-xl.png 1200w"></figure><figcaption>Nothing weird</figcaption></figure><p>Upon further inspection, I noticed that the bug appeared when I added a new FreeRTOS task. The problem was I didn't properly terminate the task using vTaskDelete().</p><p>Cannot show the code because it's super secret. I later added the vTaskDelete(NULL) and the problem is just gone.</p><p>Happy day! Sometimes life forces you to apply what you preach. üòÄ</p></div><footer class="content__footer"><div class="content__updated">Updated: <time datetime="2024-03-22T16:36">March 22, 2024</time></div><div class="content__tag"><span>Tags:</span><ul class="content__tag__list"><li><a href="https://rosmianto.com/tags/embedded-tips/" title="Embedded Tips">Embedded Tips</a></li></ul></div><div class="content__meta"><div class="content__meta__share"><h3>Share this:</h3></div></div></footer></div></div></article></main><footer class="footer section"><div class="footer__inner"><a class="logo footer__logo" href="https://rosmianto.com/">Captain Embedded üë®üèª‚Äç‚úàÔ∏è‚öì</a><div class="footer__copyright"><p>Powered by Publii</p></div></div><button class="footer__bttop js-scroll-to-top" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://rosmianto.com/assets/svg/svg-map.svg#toparrow"/></svg></button></footer><script defer="defer" src="https://rosmianto.com/assets/js/scripts.min.js?v=8680a80b5605dca08d4eef4416e29e9f"></script><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-line-numbers.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/clipboard.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-copy-to-clipboard.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-inline-color.min.js"></script></body></html>