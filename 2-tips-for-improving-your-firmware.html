<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>2 Tips for Improving Your Firmware - Captain Embedded üë®üèª‚Äç‚úàÔ∏è‚öì</title><meta name="description" content="Josh is having a very bad day at work. He is a firmware engineer btw. ‚ÄúWtf? Boss wants 2 more features added to the firmware. Heck, I didn‚Äôt even fix my bug yesterday‚Äù He complained. ‚ÄúWhy? Aren‚Äôt those 2 features simple to implement?‚Äù I asked&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script defer="defer" type="text/javascript" data-domain="rosmianto.com" src="https://plausible.io/js/plausible.js"></script><script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script><link rel="stylesheet" href="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-gray.css"><link rel="stylesheet" href="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-inline-color.css"><link rel="canonical" href="https://rosmianto.com/2-tips-for-improving-your-firmware.html"><link rel="alternate" type="application/atom+xml" href="https://rosmianto.com/feed.xml"><link rel="alternate" type="application/json" href="https://rosmianto.com/feed.json"><meta property="og:title" content="2 Tips for Improving Your Firmware"><meta property="og:image" content="https://rosmianto.com/media/posts/19/c-m-iVfOFaEghqU-unsplash.jpg"><meta property="og:image:width" content="4933"><meta property="og:image:height" content="3289"><meta property="og:site_name" content="Captain Embedded üë®üèª‚Äç‚úàÔ∏è‚öì"><meta property="og:description" content="Josh is having a very bad day at work. He is a firmware engineer btw. ‚ÄúWtf? Boss wants 2 more features added to the firmware. Heck, I didn‚Äôt even fix my bug yesterday‚Äù He complained. ‚ÄúWhy? Aren‚Äôt those 2 features simple to implement?‚Äù I asked&hellip;"><meta property="og:url" content="https://rosmianto.com/2-tips-for-improving-your-firmware.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://rosmianto.com/assets/css/style.css?v=4973c5003c8962017038e0fabea4774f"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://rosmianto.com/2-tips-for-improving-your-firmware.html"},"headline":"2 Tips for Improving Your Firmware","datePublished":"2024-03-25T10:12","dateModified":"2024-03-25T16:10","image":{"@type":"ImageObject","url":"https://rosmianto.com/media/posts/19/c-m-iVfOFaEghqU-unsplash.jpg","height":3289,"width":4933},"description":"Josh is having a very bad day at work. He is a firmware engineer btw. ‚ÄúWtf? Boss wants 2 more features added to the firmware. Heck, I didn‚Äôt even fix my bug yesterday‚Äù He complained. ‚ÄúWhy? Aren‚Äôt those 2 features simple to implement?‚Äù I asked&hellip;","author":{"@type":"Person","name":"Rosmianto A. Saputro","url":"https://rosmianto.com/authors/rosmianto-a-saputro/"},"publisher":{"@type":"Organization","name":"Rosmianto A. Saputro"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://rosmianto.com/">Captain Embedded üë®üèª‚Äç‚úàÔ∏è‚öì</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://rosmianto.com/authors/rosmianto-a-saputro/" target="_self">Articles</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Products (NEW üî•)</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://fwguide.rosmianto.com" target="_blank">Firmware Development Guide</a></li></ul></li><li><a href="https://newsletter.rosmianto.com" target="_blank">Newsletter</a></li><li><a href="https://www.linkedin.com/in/rosmianto/" target="_blank">LinkedIn</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://rosmianto.com/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://rosmianto.com/media/posts/19/c-m-iVfOFaEghqU-unsplash.jpg" srcset="https://rosmianto.com/media/posts/19/responsive/c-m-iVfOFaEghqU-unsplash-xs.jpg 300w, https://rosmianto.com/media/posts/19/responsive/c-m-iVfOFaEghqU-unsplash-sm.jpg 480w, https://rosmianto.com/media/posts/19/responsive/c-m-iVfOFaEghqU-unsplash-md.jpg 768w, https://rosmianto.com/media/posts/19/responsive/c-m-iVfOFaEghqU-unsplash-lg.jpg 1024w, https://rosmianto.com/media/posts/19/responsive/c-m-iVfOFaEghqU-unsplash-xl.jpg 1360w, https://rosmianto.com/media/posts/19/responsive/c-m-iVfOFaEghqU-unsplash-2xl.jpg 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="3289" width="4933" alt=""><figcaption>Photo by ubahnverleih on Unsplash</figcaption></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2024-03-25T10:12">March 25, 2024</time></div><h1>2 Tips for Improving Your Firmware</h1><div class="post__meta post__meta--author"><img src="https://rosmianto.com/media/website/Untitled-Diagram.jpg" loading="eager" height="1700" width="1700" class="post__author-thumb" alt="Rosmianto A. Saputro"> <a href="https://rosmianto.com/authors/rosmianto-a-saputro/" class="feed__author">Rosmianto A. Saputro</a></div></div></header></div><div class="wrapper post__entry"><div><p>Josh is having a very bad day at work. He is a firmware engineer btw.<br><br>‚ÄúWtf? Boss wants 2 more features added to the firmware. Heck, I didn‚Äôt even fix my bug yesterday‚Äù He complained.<br><br>‚ÄúWhy? Aren‚Äôt those 2 features simple to implement?‚Äù I asked him.<br><br>‚ÄúEasier said than done! I need to touch maybe 20 files to do that. I‚Äôm afraid the code will break. It‚Äôs stressing me out!‚Äù He freaked out.<br><br>Here we can see the problem, well 3 problems:<br><br>‚Ä¢ Josh is struggling to add more features<br>‚Ä¢ Josh needs to touch tens of files to make small modifications<br>‚Ä¢ Josh is scared and not confident his work will be stable enough<br><br>Poor Josh. This thing shouldn‚Äôt be happening. Adding features shouldn‚Äôt be scary. In this article, I‚Äôm going to share 2 tips to kill Josh‚Äôs problems. But before we go through those tips, a few important notes:</p></div><div><ul><li><p>Improving your firmware means you need to improve your thinking. Because writing firmware is basically thinking in code</p></li><li><p>If you have too much hassle developing firmware, it means you need to either automate something or try another approach. Adding features should be straightforward (although not always easy, mind you)</p></li></ul></div><div><h2>Code Bloat ‚Üí Kill with Method Extraction</h2></div><div><p>Now, when Josh needed to add/change something, he had to modify his code in many locations. The code is similar (or even exactly the same), and he needed to use Ctrl+F to find everything.</p></div><div><p>This issue is called code duplication or code bloats. The solution is by extracting that similar code and create a function with appropriate parameters. For example, Josh has 2 similar code everywhere:</p></div><div><pre><code>// First code block
uint8_t payload[255] = ....;

uint8_t checksum = 0;
for (int i = 0; i &lt; 255; i++) {
    // Long code here..
    checksum = ....;
}</code></pre></div><div><pre><code>// Second code block
uint8_t payload[255] = ....;

uint8_t checksum = 0;
for (int i = 0; i &lt; 254; i++) {
    // Long code here..
    checksum = ....;
}</code></pre></div><div><p>Did you notice the difference between 1st vs 2nd code block?</p></div><div><p>Second block has 254, first block instead has 255. When I asked Josh, he said that the second block for some reason needs to exclude the last byte to calculate the checksum (Wtf Josh, that is dangerous!)</p></div><div><p>Now, those two blocks can be extracted and written into a single function:</p></div><div><pre><code>uint8_t calculateChecksum(uint8_t* payload, bool excludeLastByte) {
    
    uint8_t checksum = 0;
    uint8_t payloadSize = excludeLastByte ? 254 : 255;
    // Long code here...
}</code></pre></div><div><p>From there, we can calculate checksum simply by calling <code>calculateChecksum(payload, true)</code>.</p></div><div><h2>Insecure of Code Stability ‚Üí Kill with Unit Test</h2></div><div><p>We have reduced code bloats into a single function. And this gives us one more benefit: we can test it individually. By using unit test, we can ensure that the code is consistent and outputs the correct value as we expect.</p></div><div><p>Unit testing is basically calling <code>calculateChecksum()</code> with known payload, we compare the actual checksum with the expected value. If they match, we‚Äôre fine.</p></div><div><p>Remember that unit testing doesn‚Äôt necessarily use any testing framework like Catch2, Google Test. As long as you can verify the output, you‚Äôre doing unit tests (However, manual testing is painful as the code grows, that‚Äôs why we use testing framework, to do <strong><i>automated</i></strong><strong>¬†</strong>unit testing)</p></div><div><h2>Summary</h2></div><div><p>Use those 2 tips, and you will be better at dealing with code redundancy and feel confident in your firmware. If you want to explore more about this concept, we have plenty: Test-Driven Development (TDD), Modular programming, Assertion, etc.</p></div><div><p>Those topics are actually interconnected, so take your time to learn them all.</p></div><br><p class="msg msg--info">Whenever you're ready, there are 2 ways I can help you:<br><br>1. <a href="https://fwguide.rosmianto.com" target="_blank" rel="noopener noreferrer">Professional Firmware Development Guide</a>. If you're looking to build professional-grade firmware, I share 6+ years of expertise developing firmware. This guide shows you the exact workflow I use to build high-quality firmware for my company and my freelance clients.<br><br>2. <a href="https://hobby2pro.rosmianto.com/" target="_blank" rel="noopener noreferrer">Arduino Hobbyist into Pro Embedded Engineer Book</a>. I'm writing a book to help Arduino hobbyists turn themselves into Pro Embedded Engineers.</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on March 25, 2024</p><ul class="post__tag"><li><a href="https://rosmianto.com/tags/embedded-tips/">Embedded Tips</a></li></ul><div class="post__share"></div><div class="post__bio bio"><img src="https://rosmianto.com/media/website/Untitled-Diagram.jpg" loading="lazy" height="1700" width="1700" class="bio__avatar" alt="Rosmianto A. Saputro"><div><h3 class="bio__name"><a href="https://rosmianto.com/authors/rosmianto-a-saputro/" rel="author">Rosmianto A. Saputro</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://rosmianto.com/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://rosmianto.com/3-essential-skills-to-survive-embedded-career.html" class="post__nav-link" rel="prev"><span>Previous</span> 3 Essential Skills To Survive Embedded Career</a></div><div class="post__nav-next"><a href="https://rosmianto.com/6-real-world-embedded-projects-to-learn-from-warning-not-for-beginners.html" class="post__nav-link" rel="next"><span>Next</span> 6 Real-World Embedded Projects to Learn From (Warning! Not For Beginners) </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://rosmianto.com/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2024-03-18T21:45" class="feed__date">March 18, 2024</time></div><h3 class="h1"><a href="https://rosmianto.com/3d-method-for-confident-firmware.html">3D Method for Confident Firmware</a></h3></article><article class="related__item"><div class="feed__meta"><time datetime="2024-02-09T14:44" class="feed__date">February 9, 2024</time></div><h3 class="h1"><a href="https://rosmianto.com/the-friday-firmware-newsletter.html">The Friday Firmware Newsletter</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright"><p>¬© 2024 Rosmianto</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://rosmianto.com/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://rosmianto.com/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-line-numbers.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/clipboard.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-copy-to-clipboard.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-inline-color.min.js"></script></body></html>