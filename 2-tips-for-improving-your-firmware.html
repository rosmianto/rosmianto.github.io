<!DOCTYPE html><html lang="en-us" data-theme="green-gray"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>2 Tips for Improving Your Firmware - Captain Embedded ğŸ‘¨ğŸ»â€âœˆï¸âš“</title><meta name="description" content="Josh is having a very bad day at work. He is a firmware engineer btw. â€œWtf? Boss wants 2 more features added to the firmware. Heck, I didnâ€™t even fix my bug yesterdayâ€ He complained. â€œWhy? Arenâ€™t those 2 features simple to implement?â€ I asked him. â€œEasier said than done!&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script defer="defer" type="text/javascript" data-domain="rosmianto.com" src="https://view.rosmianto.com/js/script.outbound-links.tagged-events.js"></script><script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script><link rel="stylesheet" href="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-gray.css"><link rel="stylesheet" href="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-inline-color.css"><link rel="canonical" href="https://rosmianto.com/2-tips-for-improving-your-firmware.html"><meta property="og:title" content="2 Tips for Improving Your Firmware"><meta property="og:image" content="https://rosmianto.com/media/posts/19/c-m-iVfOFaEghqU-unsplash.jpg"><meta property="og:image:width" content="4933"><meta property="og:image:height" content="3289"><meta property="og:site_name" content="Captain Embedded ğŸ‘¨ğŸ»â€âœˆï¸âš“"><meta property="og:description" content="Josh is having a very bad day at work. He is a firmware engineer btw. â€œWtf? Boss wants 2 more features added to the firmware. Heck, I didnâ€™t even fix my bug yesterdayâ€ He complained. â€œWhy? Arenâ€™t those 2 features simple to implement?â€ I asked him. â€œEasier said than done!&hellip;"><meta property="og:url" content="https://rosmianto.com/2-tips-for-improving-your-firmware.html"><meta property="og:type" content="article"><link rel="alternate" type="application/atom+xml" href="https://rosmianto.com/feed.xml"><link rel="alternate" type="application/json" href="https://rosmianto.com/feed.json"><link rel="preload" href="https://rosmianto.com/assets/dynamic/fonts/lora/lora.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://rosmianto.com/assets/dynamic/fonts/lora/lora-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://rosmianto.com/assets/css/style.css?v=306817db79d51e04a1e9a5621658ebe7"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://rosmianto.com/2-tips-for-improving-your-firmware.html"},"headline":"2 Tips for Improving Your Firmware","datePublished":"2024-03-25T10:12+07:00","dateModified":"2024-03-25T16:10+07:00","image":{"@type":"ImageObject","url":"https://rosmianto.com/media/posts/19/c-m-iVfOFaEghqU-unsplash.jpg","height":3289,"width":4933},"description":"Josh is having a very bad day at work. He is a firmware engineer btw. â€œWtf? Boss wants 2 more features added to the firmware. Heck, I didnâ€™t even fix my bug yesterdayâ€ He complained. â€œWhy? Arenâ€™t those 2 features simple to implement?â€ I asked him. â€œEasier said than done!&hellip;","author":{"@type":"Person","name":"Rosmianto A. Saputro","url":"https://rosmianto.com/authors/rosmianto-a-saputro/"},"publisher":{"@type":"Organization","name":"Rosmianto A. Saputro"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><header class="header" id="js-header"><div><a class="logo" href="https://rosmianto.com/">Captain Embedded ğŸ‘¨ğŸ»â€âœˆï¸âš“</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://rosmianto.com/authors/rosmianto-a-saputro/" target="_self">Articles</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Products (NEW ğŸ”¥)</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://freelancer.rosmianto.com/" target="_self">Becoming Embedded Freelancer</a></li><li><a href="https://fwguide.rosmianto.com" target="_blank">Firmware Development Guide</a></li></ul></li><li><a href="https://newsletter.rosmianto.com" target="_blank">Newsletter</a></li><li><a href="https://www.linkedin.com/in/rosmianto/" target="_blank">LinkedIn</a></li></ul></nav></div></header><main class="post"><article class="content"><header class="content__inner content__header--centered"><h1 class="h0 content__title">2 Tips for Improving Your Firmware</h1><div class="content__meta"><div class="content__meta__author"><img src="https://rosmianto.com/media/website/Untitled-Diagram.jpg" loading="eager" height="1700" width="1700" class="content__avatar" alt="Rosmianto A. Saputro"><div><a href="https://rosmianto.com/authors/rosmianto-a-saputro/" class="content__author">Rosmianto A. Saputro</a> <time datetime="2024-03-25T10:12" class="content__date">March 25, 2024</time></div></div></div></header><div class="content__body"><div class="content__inner"><div class="content__entry"><div><p>Josh is having a very bad day at work. He is a firmware engineer btw.<br><br>â€œWtf? Boss wants 2 more features added to the firmware. Heck, I didnâ€™t even fix my bug yesterdayâ€ He complained.<br><br>â€œWhy? Arenâ€™t those 2 features simple to implement?â€ I asked him.<br><br>â€œEasier said than done! I need to touch maybe 20 files to do that. Iâ€™m afraid the code will break. Itâ€™s stressing me out!â€ He freaked out.<br><br>Here we can see the problem, well 3 problems:<br><br>â€¢ Josh is struggling to add more features<br>â€¢ Josh needs to touch tens of files to make small modifications<br>â€¢ Josh is scared and not confident his work will be stable enough<br><br>Poor Josh. This thing shouldnâ€™t be happening. Adding features shouldnâ€™t be scary. In this article, Iâ€™m going to share 2 tips to kill Joshâ€™s problems. But before we go through those tips, a few important notes:</p></div><div><ul><li><p>Improving your firmware means you need to improve your thinking. Because writing firmware is basically thinking in code</p></li><li><p>If you have too much hassle developing firmware, it means you need to either automate something or try another approach. Adding features should be straightforward (although not always easy, mind you)</p></li></ul></div><div><h2>Code Bloat â†’ Kill with Method Extraction</h2></div><div><p>Now, when Josh needed to add/change something, he had to modify his code in many locations. The code is similar (or even exactly the same), and he needed to use Ctrl+F to find everything.</p></div><div><p>This issue is called code duplication or code bloats. The solution is by extracting that similar code and create a function with appropriate parameters. For example, Josh has 2 similar code everywhere:</p></div><div><pre><code>// First code block
uint8_t payload[255] = ....;

uint8_t checksum = 0;
for (int i = 0; i &lt; 255; i++) {
    // Long code here..
    checksum = ....;
}</code></pre></div><div><pre><code>// Second code block
uint8_t payload[255] = ....;

uint8_t checksum = 0;
for (int i = 0; i &lt; 254; i++) {
    // Long code here..
    checksum = ....;
}</code></pre></div><div><p>Did you notice the difference between 1st vs 2nd code block?</p></div><div><p>Second block has 254, first block instead has 255. When I asked Josh, he said that the second block for some reason needs to exclude the last byte to calculate the checksum (Wtf Josh, that is dangerous!)</p></div><div><p>Now, those two blocks can be extracted and written into a single function:</p></div><div><pre><code>uint8_t calculateChecksum(uint8_t* payload, bool excludeLastByte) {
    
    uint8_t checksum = 0;
    uint8_t payloadSize = excludeLastByte ? 254 : 255;
    // Long code here...
}</code></pre></div><div><p>From there, we can calculate checksum simply by calling <code>calculateChecksum(payload, true)</code>.</p></div><div><h2>Insecure of Code Stability â†’ Kill with Unit Test</h2></div><div><p>We have reduced code bloats into a single function. And this gives us one more benefit: we can test it individually. By using unit test, we can ensure that the code is consistent and outputs the correct value as we expect.</p></div><div><p>Unit testing is basically calling <code>calculateChecksum()</code> with known payload, we compare the actual checksum with the expected value. If they match, weâ€™re fine.</p></div><div><p>Remember that unit testing doesnâ€™t necessarily use any testing framework like Catch2, Google Test. As long as you can verify the output, youâ€™re doing unit tests (However, manual testing is painful as the code grows, thatâ€™s why we use testing framework, to do <strong><i>automated</i></strong><strong>Â </strong>unit testing)</p></div><div><h2>Summary</h2></div><div><p>Use those 2 tips, and you will be better at dealing with code redundancy and feel confident in your firmware. If you want to explore more about this concept, we have plenty: Test-Driven Development (TDD), Modular programming, Assertion, etc.</p></div><div><p>Those topics are actually interconnected, so take your time to learn them all.</p></div></div><footer class="content__footer"><div class="content__updated">Updated: <time datetime="2024-03-25T16:10">March 25, 2024</time></div><div class="content__tag"><span>Tags:</span><ul class="content__tag__list"><li><a href="https://rosmianto.com/tags/embedded-tips/" title="Embedded Tips">Embedded Tips</a></li></ul></div><div class="content__meta"><div class="content__meta__share"><h3>Share this:</h3></div></div></footer></div></div></article><div class="section content__related"><div class="wrapper"><h3 class="h4 section__title">You may also like:</h3><div class="card-container card-container--col4"><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://rosmianto.com/day-8-how-to-get-your-first-embedded-freelance-client.html" class="invert">Embedded Freelancer Series: How to get your first embedded freelance client? (8/8)</a></h2><p>How to get your first embedded freelance client?...</p><footer class="card__footer"><time datetime="2025-01-29T16:09">January 29, 2025 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Frosmianto.com%2Fday-8-how-to-get-your-first-embedded-freelance-client.html&title=Embedded%20Freelancer%20Series%3A%20How%20to%20get%20your%20first%20embedded%20freelance%20client%3F%20(8%2F8)" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://rosmianto.com/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://rosmianto.com/day-3-imagine-this-story-in-your-head.html" class="invert">Embedded Freelancer Series: Imagine this story in your head (3/8)</a></h2><p>Imagine this story in your head. Let&#x27;s say...</p><footer class="card__footer"><time datetime="2025-01-29T15:56">January 29, 2025 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Frosmianto.com%2Fday-3-imagine-this-story-in-your-head.html&title=Embedded%20Freelancer%20Series%3A%20Imagine%20this%20story%20in%20your%20head%20(3%2F8)" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://rosmianto.com/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://rosmianto.com/day-2-two-ways-to-boost-your-income-as-an-embedded-engineer.html" class="invert">Embedded Freelancer Series: Two ways to boost your income as an embedded engineer (2/8)</a></h2><p>I want to offer better ways to boost...</p><footer class="card__footer"><time datetime="2025-01-29T15:54">January 29, 2025 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Frosmianto.com%2Fday-2-two-ways-to-boost-your-income-as-an-embedded-engineer.html&title=Embedded%20Freelancer%20Series%3A%20Two%20ways%20to%20boost%20your%20income%20as%20an%20embedded%20engineer%20(2%2F8)" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://rosmianto.com/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article><article class="card"><div class="card__content"><h2 class="card__title"><a href="https://rosmianto.com/3d-method-for-confident-firmware.html" class="invert">3D Method for Confident Firmware</a></h2><p>Sometimes you just feel that your firmware isn&#x27;t...</p><footer class="card__footer"><time datetime="2024-03-18T21:45">March 18, 2024 </time><a href="https://getpocket.com/save?url=https%3A%2F%2Frosmianto.com%2F3d-method-for-confident-firmware.html&title=3D%20Method%20for%20Confident%20Firmware" class="btn btn--clean card__readlater js-share" aria-label="Read later"><svg><use xlink:href="https://rosmianto.com/assets/svg/svg-map.svg#readlater"/></svg></a></footer></div></article></div></div></div></main><footer class="footer section section--lightest"><div class="footer__inner"><a class="logo footer__logo" href="https://rosmianto.com/">Captain Embedded ğŸ‘¨ğŸ»â€âœˆï¸âš“</a><div class="footer__copyright"><p>Powered by Publii</p></div></div><button class="footer__bttop js-scroll-to-top" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://rosmianto.com/assets/svg/svg-map.svg#toparrow"/></svg></button></footer><script defer="defer" src="https://rosmianto.com/assets/js/scripts.min.js?v=8680a80b5605dca08d4eef4416e29e9f"></script><script>window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-line-numbers.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/clipboard.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-copy-to-clipboard.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-inline-color.min.js"></script></body></html>